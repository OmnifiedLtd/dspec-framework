meta:
  id: feature.catalog.publish-product
  name: Publish Product under Brand with collision-free identifiers
  owner: Catalog Team
  domain_id: catalog

intent: 'Publish products under brands; ensure identifier collisions cannot occur at publish time.'
scope:
  in:
    - id: scope.publish
      statement: 'publish product'
    - id: scope.activate
      statement: 'activate variant'
  out:
    - id: scope.reindexing
      statement: 'bulk reindexing'
    - id: scope.search
      statement: 'search relevance tuning'

domain_invariants:
  - id: unique-model-code-per-brand
    rule: 'Within the same Brand, no two Active Products share the same modelCode.'
    moment_of_truth: 'product-activated'
    consistency_demand:
      scope: 'brand'
      strength: 'write-time'
      tolerance: 'none'
  - id: variant-sku-unique-per-product
    rule: "A Product's Variant SKUs are unique within that Product."
    moment_of_truth: 'variant-activated'
    consistency_demand:
      scope: 'product'
      strength: 'write-time'
      tolerance: 'none'

environmental_constraints:
  - id: constr.volume
    statement: 'Some brands exceed 500k products; solutions must avoid brand-sized locks/scans.'
  - id: constr.rate
    statement: 'Burst rates up to 2k publishes/minute per brand.'

acceptance_criteria:
  - id: ac-1
    statement: 'Publishing a duplicate modelCode under a Brand is deterministically rejected.'
  - id: ac-2
    statement: 'Concurrent publishes with distinct modelCodes do not falseâ€‘fail as duplicates.'