"use strict";(self.webpackChunkdocusaurus_tailwind_shadcn_template=self.webpackChunkdocusaurus_tailwind_shadcn_template||[]).push([["9318"],{73224:function(e,n,s){s.r(n),s.d(n,{metadata:()=>i,default:()=>m,frontMatter:()=>a,contentTitle:()=>o,toc:()=>d,assets:()=>l});var i=JSON.parse('{"id":"level-1-design-dspec","title":"Level-1 Design dspec","description":"Level\u20111 translates the functional requirements of Level\u20110 into a concrete logical architecture. It defines the Application Interface\u2014the set of operations available to the outside world.","source":"@site/docs/09-level-1-design-dspec.md","sourceDirName":".","slug":"/level-1-design-dspec","permalink":"/dspec-framework/docs/level-1-design-dspec","draft":false,"unlisted":false,"editUrl":"https://github.com/OmnifiedLtd/dspec-framework/tree/main/docs/09-level-1-design-dspec.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"layout":"default","title":"Level-1 Design dspec","nav_order":10},"sidebar":"tutorialSidebar","previous":{"title":"Level-0 Feature dspec","permalink":"/dspec-framework/docs/level-0-feature-dspec"},"next":{"title":"Level-2 Implementation dspec","permalink":"/dspec-framework/docs/level-2-implementation-dspec"}}'),t=s(74848),r=s(84429);let a={layout:"default",title:"Level-1 Design dspec",nav_order:10},o="Level\u20111 \u2014 Design dspec",l={},d=[{value:"meta",id:"meta",level:2},{value:"extends",id:"extends",level:2},{value:"invariant_mechanisms",id:"invariant_mechanisms",level:2},{value:"consistency_groups",id:"consistency_groups",level:2},{value:"commands",id:"commands",level:2},{value:"queries",id:"queries",level:2},{value:"A Note on CQRS (Command Query Responsibility Segregation)",id:"a-note-on-cqrs-command-query-responsibility-segregation",level:2},{value:"Option A: Strict Separation (CQRS)",id:"option-a-strict-separation-cqrs",level:3},{value:"Option B: Pragmatic / Mixed",id:"option-b-pragmatic--mixed",level:3},{value:"Example: Identity Commands",id:"example-identity-commands",level:3},{value:"E\u2011commerce Commands",id:"ecommerce-commands",level:3},{value:"Product Catalog: Brand/Product/Variant (Design)",id:"product-catalog-brandproductvariant-design",level:3},{value:"CRM: Sales\u2011to\u2011Contract (Design)",id:"crm-salestocontract-design",level:3}];function c(e){let n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"level1--design-dspec",children:"Level\u20111 \u2014 Design dspec"})}),"\n",(0,t.jsxs)(n.p,{children:["Level\u20111 translates the functional requirements of Level\u20110 into a concrete logical architecture. It defines the ",(0,t.jsx)(n.strong,{children:"Application Interface"}),"\u2014the set of operations available to the outside world."]}),"\n",(0,t.jsxs)(n.p,{children:['In "Clean Architecture" terms, this level defines your ',(0,t.jsx)(n.strong,{children:"Use Cases"})," and ",(0,t.jsx)(n.strong,{children:"Entities"}),'.\nIn "Domain Modeling Made Functional" terms, this level defines your ',(0,t.jsx)(n.strong,{children:"Workflows"})," and ",(0,t.jsx)(n.strong,{children:"Read Models"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"A Level-1 Spec consists of these main parts:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Meta:"})," Metadata identifying the design spec."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Extends:"})," Reference to the Level-0 feature this design refines."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Invariant Mechanisms:"})," How Level-0 invariants are enforced at the design level."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Consistency Groups (Aggregates):"})," The boundaries where business invariants are enforced."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Commands (Writes):"})," Requests to change state."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Queries (Reads):"})," Requests to retrieve data."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"meta",children:"meta"}),"\n",(0,t.jsx)(n.p,{children:"Every Level-1 spec must have a meta section identifying it:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'meta:\n  id: design.passwordless-login\n  name: Passwordless Login Design\n  owner: Identity Team\n  description: "Level-1 design for magic link authentication"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"extends",children:"extends"}),"\n",(0,t.jsx)(n.p,{children:"Links this design spec to the Level-0 feature it refines:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"extends: feature.passwordless-login\n"})}),"\n",(0,t.jsx)(n.h2,{id:"invariant_mechanisms",children:"invariant_mechanisms"}),"\n",(0,t.jsxs)(n.p,{children:["Maps Level-0 invariants to their enforcement mechanisms. This is where you document ",(0,t.jsx)(n.em,{children:"how"})," each business rule will be enforced at the design level."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'invariant_mechanisms:\n  - invariant_ref: link-single-use\n    mechanism: partitioned-unique-index\n    notes: "Enforced via unique index on link_id where status = \'redeemed\'"\n  - invariant_ref: unique-model-code-per-brand\n    mechanism: db-constraint\n    notes: "Unique constraint on (brand_id, model_code) where active = true"\n'})}),"\n",(0,t.jsx)(n.p,{children:"Common mechanisms include:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"partitioned-unique-index"})," \u2014 Fast, scalable enforcement for uniqueness rules"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"reservation-then-confirm"})," \u2014 Two-phase claim for hot keys"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"db-constraint"})," \u2014 Simple database-level enforcement"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"saga-compensation"})," \u2014 For cross-system invariants with eventual consistency"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"application-validation"})," \u2014 Checked in application code before persistence"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"consistency_groups",children:"consistency_groups"}),"\n",(0,t.jsx)(n.p,{children:"These define your transactional boundaries. Every Command targets a specific Consistency Group."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"consistency_groups:\n  - id: order\n    name: OrderAggregate\n"})}),"\n",(0,t.jsx)(n.h2,{id:"commands",children:"commands"}),"\n",(0,t.jsx)(n.p,{children:'Commands represent the "Write" side of your application. They enforce invariants and produce events.'}),"\n",(0,t.jsxs)(n.p,{children:["Commands now include ",(0,t.jsx)(n.strong,{children:"state_transitions"})," to explicitly link to domain model lifecycles, and ",(0,t.jsx)(n.strong,{children:"structured failure modes"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"commands:\n  - id: submit-order\n    name: SubmitOrder\n    target: order\n    intent: 'Transition order from Draft to Submitted'\n    preconditions: ['order-not-empty']\n    postconditions:\n      state_transitions:\n        - entity: order\n          from: draft\n          to: submitted\n      emits:\n        - event: order-submitted\n        - event: low-stock-alert\n          when: inventory.below-threshold  # conditional emission\n    failure_modes:\n      - violates: 'order-not-empty'\n        outcome:\n          action: reject\n          error_code: '400'\n          message: 'Order must contain at least one item'\n"})}),"\n",(0,t.jsx)(n.h2,{id:"queries",children:"queries"}),"\n",(0,t.jsx)(n.p,{children:'Queries represent the "Read" side. They define the questions external actors can ask the system.'}),"\n",(0,t.jsxs)(n.p,{children:["Queries can include a ",(0,t.jsx)(n.strong,{children:"freshness"})," property for CQRS/eventually-consistent systems:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"queries:\n  - id: get-order-history\n    name: GetOrderHistory\n    intent: 'View past orders for a user'\n    parameters:\n      - name: userId\n        type: string\n    returns:\n      type: List<OrderSummary>\n      description: 'Summarized view of past orders'\n    freshness:\n      tolerance: PT30S  # ISO 8601 duration\n      description: 'Data may be up to 30 seconds stale'\n"})}),"\n",(0,t.jsx)(n.h2,{id:"a-note-on-cqrs-command-query-responsibility-segregation",children:"A Note on CQRS (Command Query Responsibility Segregation)"}),"\n",(0,t.jsxs)(n.p,{children:["The dspec framework supports, but ",(0,t.jsx)(n.strong,{children:"does not enforce"}),", strict CQRS."]}),"\n",(0,t.jsx)(n.h3,{id:"option-a-strict-separation-cqrs",children:"Option A: Strict Separation (CQRS)"}),"\n",(0,t.jsxs)(n.p,{children:["Commands only return ",(0,t.jsx)(n.code,{children:"void"})," (or Ack/Nack) and publish Events. Queries return Data."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Pros:"})," Decouples write logic from read logic; allows independent scaling."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Cons:"}),' Higher complexity; "eventual consistency" UI challenges.']}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"option-b-pragmatic--mixed",children:"Option B: Pragmatic / Mixed"}),"\n",(0,t.jsx)(n.p,{children:"Commands can return data directly. This is often simpler for CRUD apps or where immediate feedback (like a generated ID) is required."}),"\n",(0,t.jsxs)(n.p,{children:["To support this, Commands have an optional ",(0,t.jsx)(n.code,{children:"returns"})," property:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"commands:\n  - id: create-user\n    name: CreateUser\n    target: user\n    intent: 'Register a new user account'\n    postconditions:\n      emits:\n        - event: user-created\n    returns:\n      type: UserCreatedResponse\n      description: 'Contains the generated User ID'\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"example-identity-commands",children:"Example: Identity Commands"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"meta:\n  id: design.passwordless-login\n  name: Passwordless Login Design\n  owner: Identity Team\n\nextends: feature.passwordless-login\n\ninvariant_mechanisms:\n  - invariant_ref: link-single-use\n    mechanism: db-constraint\n    notes: \"Unique constraint ensures link can only be marked redeemed once\"\n  - invariant_ref: link-expiry\n    mechanism: application-validation\n    notes: \"TTL checked against current time before redemption\"\n\ncommands:\n  - id: request-magic-link\n    name: RequestMagicLink\n    target: magic-link\n    intent: 'Issue a time-bound, single-use link'\n    preconditions: ['user-verified']\n    postconditions:\n      state_transitions:\n        - entity: magic-link\n          from: issued\n          to: issued\n      emits:\n        - event: magic-link-issued\n\n  - id: redeem-magic-link\n    name: RedeemMagicLink\n    target: magic-link\n    intent: 'Authenticate via issued link'\n    preconditions: ['link-single-use', 'link-expiry']\n    postconditions:\n      state_transitions:\n        - entity: magic-link\n          from: issued\n          to: redeemed\n      emits:\n        - event: magic-link-redeemed\n    transactional_expectation: 'atomic-within-group'\n    failure_modes:\n      - violates: 'link-single-use'\n        outcome:\n          action: reject\n          error_code: '409'\n          message: 'Link has already been redeemed'\n      - violates: 'link-expiry'\n        outcome:\n          action: reject\n          error_code: '410'\n          message: 'Link has expired'\n"})}),"\n",(0,t.jsx)(n.h3,{id:"ecommerce-commands",children:"E\u2011commerce Commands"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:s(93528).A+"",children:["See full example in ",(0,t.jsx)(n.code,{children:"examples/ecommerce/level1.yaml"})]})}),"\n",(0,t.jsx)(n.h3,{id:"product-catalog-brandproductvariant-design",children:"Product Catalog: Brand/Product/Variant (Design)"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:s(21785).A+"",children:["See full example in ",(0,t.jsx)(n.code,{children:"examples/catalog/level1.yaml"})]})}),"\n",(0,t.jsx)(n.h3,{id:"crm-salestocontract-design",children:"CRM: Sales\u2011to\u2011Contract (Design)"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:s(57900).A+"",children:["See full example in ",(0,t.jsx)(n.code,{children:"examples/crm/level1.yaml"})]})})]})}function m(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},21785:function(e,n,s){s.d(n,{A:()=>i});let i=s.p+"assets/files/level1-5368e895549979094c6c4132a8172910.yaml"},57900:function(e,n,s){s.d(n,{A:()=>i});let i=s.p+"assets/files/level1-987f8157f9762852b98844a83f116ccf.yaml"},93528:function(e,n,s){s.d(n,{A:()=>i});let i=s.p+"assets/files/level1-2bb35e1ecf660b768b855b640638c9e6.yaml"},84429:function(e,n,s){s.d(n,{R:()=>a,x:()=>o});var i=s(96540);let t={},r=i.createContext(t);function a(e){let n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);